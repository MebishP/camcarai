<!DOCTYPE html>
<html>
<head>
    <title>Voice to Text</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
        }

        #startButton, #languageButton {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            transition: background-color 0.3s ease;
        }

        #startButton:hover, #languageButton:hover {
            background-color: #0056b3;
        }

        #output, #geminiOutput {
            margin-top: 20px;
            padding: 20px;
            font-size: 18px;
            color: #333;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            display: inline-block;
            min-width: 300px;
            text-align: left;
        }

        #geminiOutput {
            background-color: #e6f7ff;
            font-weight: bold;
            font-size: 36px;
            text-align: center;
        }

        header {
            background-color: #007bff;
            color: white;
            padding: 20px 0;
            margin-bottom: 20px;
        }

        header h1 {
            margin: 0;
            font-size: 24px;
        }

        .output-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .loading {
            display: none;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <header>
        <h1>Voice to Text with Gemini Robot Control</h1>
    </header>
    <button id="startButton">Start Voice Input</button>
    <button id="languageButton">Switch to Tamil</button>
    
    <div class="output-container">
        <div id="output">Your transcribed text will appear here...</div>
        <div class="loading" id="loading">Processing with Gemini...</div>
        <div id="geminiOutput">Robot command will appear here</div>
    </div>

    <script>
        const startButton = document.getElementById('startButton');
        const outputDiv = document.getElementById('output');
        const languageButton = document.getElementById('languageButton');
        const geminiOutputDiv = document.getElementById('geminiOutput');
        const loadingDiv = document.getElementById('loading');

        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition || window.mozSpeechRecognition || window.msSpeechRecognition)();
        recognition.lang = 'en-US';

        recognition.onstart = () => {
            startButton.textContent = 'Listening...';
            startButton.disabled = true;
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            outputDiv.textContent = transcript;
        };

        recognition.onend = () => {
            startButton.textContent = 'Start Voice Input';
            startButton.disabled = false;
            
            // Automatically process the transcript with Gemini when speech recognition ends
            const text = outputDiv.textContent;
            if (text && text !== 'Your transcribed text will appear here...') {
                processWithGemini(text);
            }
        };

        startButton.addEventListener('click', () => {
            recognition.start();
            // Clear previous Gemini output when starting new voice input
            geminiOutputDiv.textContent = "Robot command will appear here";
        });

        languageButton.addEventListener('click', () => {
            if (recognition.lang === 'en-US') {
                recognition.lang = 'ta-IN';
                languageButton.textContent = 'Switch to English';
            } else {
                recognition.lang = 'en-US';
                languageButton.textContent = 'Switch to Tamil';
            }
        });

        // Gemini API integration
        async function processWithGemini(text) {
            loadingDiv.style.display = 'block';
            
            try {
                const response = await fetch('https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=AIzaSyB_XP7-HDvVfnEcejybkmwgIgsV5cWhC8g', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [
                            {
                                role: 'user',
                                parts: [
                                    {
                                        text: text
                                    }
                                ]
                            }
                        ],
                        systemInstruction: {
                            parts: [
                                {
                                    text: "You are a robot\nWhen I say a phrase or word related to going front\nSay 'f'\nIf right r\nLeft l\nStop s\nBack b\nIf you feel if it hints to the phrase return the letter\nAnd if it does not mean anything\nReturn s\nAnd only say these words and don't utter a word other than these letters"
                                }
                            ]
                        }
                    })
                });

                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    const geminiResponse = data.candidates[0].content.parts[0].text;
                    geminiOutputDiv.textContent = geminiResponse;
                } else {
                    geminiOutputDiv.textContent = "Error: No valid response from Gemini";
                }
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                geminiOutputDiv.textContent = "Error processing with Gemini";
            } finally {
                loadingDiv.style.display = 'none';
            }
        }
    </script>
</body>
</html>